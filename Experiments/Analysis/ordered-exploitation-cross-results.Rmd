# Ordered exploitation results

Here we present the results for **best performances** found by each selection scheme replicate on the exploitation rate diagnostic.
Best performance found refers to the largest average trait score found in a given population.
Note that performance values fall between 0 and 100.

## Analysis dependencies

```{r ord-libs, message=FALSE}
library(ggplot2)
library(cowplot)
library(dplyr)
library(PupillometryR)
```

## Setup

These analyses were conducted in the following computing environment:

```{r ord-ver}
print(version)
```

## Performance over time

Best performance in a population over time.

```{r ord-per-ot, warning=FALSE}
ordered_exploitation = filter(cc_over_time, diagnostic == 'ordered_exploitation')
lines = ordered_exploitation %>%
        group_by(`Selection\nScheme`, gen) %>%
          dplyr::summarise(
            min = min(pop_fit_max),
            mean = mean(pop_fit_max),
            max = max(pop_fit_max)
          )
points = filter(lines, gen %% 2000 == 0 & gen != 0)

ot = ggplot(lines, aes(x=gen, y=mean / TRAITS, group = `Selection\nScheme`, fill =`Selection\nScheme`, color = `Selection\nScheme`, shape = `Selection\nScheme`)) +
  geom_ribbon(aes(ymin = min / TRAITS, ymax = max / TRAITS), alpha = 0.1) +
  geom_line(size = 0.5) +
  geom_point(data = points, size = 1.5, stroke = 2.0, alpha = 1.0) +
  scale_y_continuous(
    name="Average trait score",
    limits=c(-1, 101),
    breaks=seq(0,100, 20),
    labels=c("0", "20", "40", "60", "80", "100")
  ) +
  scale_x_continuous(
    name="Generations",
    limits=c(0, 50000),
    breaks=c(0, 10000, 20000, 30000, 40000, 50000),
    labels=c("0e+6", "1e+6", "2e+6", "3e+6", "4e+6", "5e+6")

  ) +
  scale_shape_manual(values=SHAPE)+
  scale_colour_manual(values = cb_palette) +
  scale_fill_manual(values = cb_palette) +
  ggtitle("Best performance over time") +
  p_theme+
    guides(
    shape=guide_legend(ncol=2, title.position = "bottom"),
    color=guide_legend(ncol=2, title.position = "bottom"),
    fill=guide_legend(ncol=2, title.position = "bottom")
  ) +
  theme(
    legend.position = "bottom",
    legend.box="verticle",
    legend.justification="center",
    legend.title=element_blank()
  )

ot
```

```{r ord-per-lgd, echo = FALSE}
legend <- cowplot::get_legend(
  ot +
    guides(
      shape=guide_legend(ncol=2, title.position = "bottom"),
      color=guide_legend(ncol=2, title.position = "bottom"),
      fill=guide_legend(ncol=2, title.position = "bottom")
    ) +
    theme(
      legend.position = "top",
      legend.box="verticle",
      legend.justification="center",
      legend.title=element_blank()
    )
)
```

## Best performance throughout

Best performance throughout 50,000 generations.

```{r ord-per-bst}
plot = filter(cc_best, col == 'pop_fit_max' & diagnostic == 'ordered_exploitation') %>%
  ggplot(., aes(x = acron, y = val / TRAITS, color = acron, fill = acron, shape = acron)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), scale = 'width', alpha = 0.2) +
  geom_point(position = position_jitter(width = .1), size = 1.5, alpha = 1.0) +
  geom_boxplot(color = 'black', width = .2, outlier.shape = NA, alpha = 0.0) +
  scale_y_continuous(
    name="Average trait score",
    limits=c(-1, 101),
    breaks=seq(0,100, 20),
    labels=c("0", "20", "40", "60", "80", "100")
  ) +
  scale_x_discrete(
    name="Scheme"
  )+
  scale_shape_manual(values=SHAPE)+
  scale_colour_manual(values = cb_palette) +
  scale_fill_manual(values = cb_palette) +
  p_theme

plot_grid(
  plot +
    ggtitle("Best performance throughout") +
    theme(legend.position="none"),
  legend,
  nrow=2,
  rel_heights = c(2,.55),
  label_size = TSIZE
)
```

### Stats

Summary statistics for the performance of the best performance throughout 50,000 generations.

```{r ord-per-sum}
performance = filter(cc_best, col == 'pop_fit_max' & diagnostic == 'ordered_exploitation')
performance$acron = factor(performance$acron, levels = c('tru', 'tor', 'lex','nds', 'gfs', 'pfs', 'nov',  'ran'))
performance%>%
group_by(acron) %>%
  dplyr::summarise(
    count = n(),
    na_cnt = sum(is.na(val)),
    min = min(val / TRAITS, na.rm = TRUE),
    median = median(val / TRAITS, na.rm = TRUE),
    mean = mean(val / TRAITS, na.rm = TRUE),
    max = max(val / TRAITS, na.rm = TRUE),
    IQR = IQR(val / TRAITS, na.rm = TRUE)
  )
```

Kruskal–Wallis test provides evidence of statistical differences among best performance found throughout 50,000 generations.

```{r ord-per-kru}
kruskal.test(val ~ acron, data = performance)
```

Results for post-hoc Wilcoxon rank-sum test with a Bonferroni correction on the best performance found throughout 50,000 generations.

```{r ord-per-wil}
pairwise.wilcox.test(x = performance$val, g = performance$acron, p.adjust.method = "bonferroni",
                     paired = FALSE, conf.int = FALSE, alternative = 'l')
```

## Generation satisfactory solution found

First generation a satisfactory solution is found throughout the 50,000 generations.

```{r ord-ssf, warning=FALSE}
ssf = filter(cc_ssf, diagnostic == 'ordered_exploitation')
schemes = data.frame()

for (i in 1:8) {
  if(i == 3)
  {
    schemes = rbind(schemes, filter(ssf, acron == ACRON[i]))
    next
  }
  schemes = rbind(schemes, filter(ssf, acron == ACRON[i] & trt == PARAM[i]))
}

plot <- ggplot(schemes, aes(x = acron, y = generation, color = acron, fill = acron, shape = acron)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), scale = 'width', alpha = 0.2) +
  geom_point(position = position_jitter(width = .1), size = 1.5, alpha = 1.0) +
  geom_boxplot(color = 'black', width = .2, outlier.shape = NA, alpha = 0.0) +
  scale_shape_manual(values=SHAPE)+
  scale_y_continuous(
    name="Generation",
    limits=c(0, 60000),
    breaks=c(0, 10000, 20000, 30000, 40000, 50000, 60000),
    labels=c("0e+6", "1e+6", "2e+6", "3e+6", "4e+6", "5e+6", "Fail")
  ) +
  scale_x_discrete(
    name="Scheme"
  ) +
  scale_colour_manual(values = cb_palette) +
  scale_fill_manual(values = cb_palette) +
  p_theme

plot_grid(
  plot +
    ggtitle("Generation satisfactory solution found") +
    theme(legend.position="none"),
  legend,
  nrow=2,
  rel_heights = c(2,.55),
  label_size = TSIZE
)
```

### Stats

Summary statistics for the first generation a satisfactory solution is found throughout the 50,000 generations.

```{r ord-ssf-sum}
schemes <- filter(schemes, acron == 'tru' | acron == 'tor' | acron == 'lex')
group_by(schemes, acron) %>%
  dplyr::summarise(
    count = n(),
    na_cnt = sum(is.na(generation)),
    min = min(generation, na.rm = TRUE),
    median = median(generation, na.rm = TRUE),
    mean = mean(generation, na.rm = TRUE),
    max = max(generation, na.rm = TRUE),
    IQR = IQR(generation, na.rm = TRUE)
  )
```

Kruskal–Wallis test provides evidence of difference amoung selection schemes the first generation a satisfactory solution is found throughout the 50,000 generations..

```{r ord-ssf-kru}
kruskal.test(generation ~ acron, data = schemes)
```

Results for post-hoc Wilcoxon rank-sum test with a Bonferroni correction on the first generation a satisfactory solution is found throughout the 50,000 generations.

```{r ord-ssf-wil}
pairwise.wilcox.test(x = schemes$generation, g = schemes$acron, p.adjust.method = "bonferroni",
                     paired = FALSE, conf.int = FALSE, alternative = 'g')
```

## Streaks

### Over time

Best streak in a population over time.

```{r ord-sot, warning=FALSE}
streaks_df = filter(ordered_exploitation, acron == 'pfs' | acron == 'nds' | acron == 'gfs' | acron == 'nov')
streaks_df$`Selection\nScheme` <- factor(streaks_df$`Selection\nScheme`, levels = c('Nondominated Sorting (nds)','Genotypic Fitness Sharing (gfs)','Phenotypic Fitness Sharing (pfs)','Novelty Search (nov)'))

lines = streaks_df %>%
  group_by(`Selection\nScheme`, gen) %>%
  dplyr::summarise(
    min = min(pop_str_max),
    mean = mean(pop_str_max),
    max = max(pop_str_max)
  )
points = filter(lines, gen %% 2000 == 0 & gen != 0)

ot = ggplot(lines, aes(x=gen, y=mean, group = `Selection\nScheme`, fill =`Selection\nScheme`, color = `Selection\nScheme`, shape = `Selection\nScheme`)) +
  geom_ribbon(aes(ymin = min, ymax = max), alpha = 0.1) +
  geom_line(size = 0.5) +
  geom_point(data = points, size = 1.5, stroke = 2.0, alpha = 1.0) +
  scale_y_continuous(
    name="Length",
    limits=c(-1, 51),
    breaks=seq(0,50, 10),
    labels=c("0", "10", "20", "30", "40", "50")
  ) +
  scale_x_continuous(
    name="Generations",
    limits=c(0, 50000),
    breaks=c(0, 10000, 20000, 30000, 40000, 50000),
    labels=c("0e+6", "1e+6", "2e+6", "3e+6", "4e+6", "5e+6")

  ) +
  scale_shape_manual(values=SHAPE)+
  scale_colour_manual(values = cb_palette) +
  scale_fill_manual(values = cb_palette) +
  ggtitle("Streak length over time") +
  p_theme+
  guides(
    shape=guide_legend(ncol=2, title.position = "bottom"),
    color=guide_legend(ncol=2, title.position = "bottom"),
    fill=guide_legend(ncol=2, title.position = "bottom")
  ) +
  theme(
    legend.position = "bottom",
    legend.box="verticle",
    legend.justification="center",
    legend.title=element_blank()
  )

ot
```

```{r ord-stk-lgd, echo = FALSE}
legend <- cowplot::get_legend(
  ot +
    guides(
      shape=guide_legend(nrow=2),
      color=guide_legend(nrow=2),
      fill=guide_legend(nrow=2)
    ) +
    theme(
      legend.position = "top",
      legend.box="verticle",
      legend.justification="center",
      legend.title=element_blank()
    )
)
```

### End of 50,000 generations

Best streak in the population at the end of 50,000 generations.

```{r ord-stk-end}
end <- filter(streaks_df, gen == 50000)
end = filter(end, acron == 'pfs' | acron == 'nds' | acron == 'gfs' | acron == 'nov')
end$acron <- factor(end$acron, levels = c('nds','gfs','pfs','nov'))

plot = ggplot(end, aes(x = acron, y = pop_str_max, color = acron, fill = acron, shape = acron)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), scale = 'width', alpha = 0.2) +
  geom_point(position = position_jitter(width = .1), size = 1.5, alpha = 1.0) +
  geom_boxplot(color = 'black', width = .2, outlier.shape = NA, alpha = 0.0) +
  scale_y_continuous(
    name="Length",
    limits=c(-1, 51),
    breaks=seq(0,50, 10),
    labels=c("0", "10", "20", "30", "40", "50")
  ) +
  scale_x_discrete(
    name="Scheme"
  )+
  scale_shape_manual(values=SHAPE)+
  scale_colour_manual(values = cb_palette) +
  scale_fill_manual(values = cb_palette) +
  coord_flip()+
  p_theme

plot_grid(
  plot +
    ggtitle("Final streak length") +
    theme(legend.position="none"),
  legend,
  nrow=2,
  rel_heights = c(2,.55),
  label_size = TSIZE
)
```

#### Stats

Summary statistics for best streak in the population at the end of 50,000 generations.

```{r ord-stk-sum}
group_by(end, acron) %>%
  dplyr::summarise(
    count = n(),
    na_cnt = sum(is.na(pop_str_max)),
    min = min(pop_str_max, na.rm = TRUE),
    median = median(pop_str_max, na.rm = TRUE),
    mean = mean(pop_str_max, na.rm = TRUE),
    max = max(pop_str_max, na.rm = TRUE),
    IQR = IQR(pop_str_max, na.rm = TRUE)
  )
```

Kruskal–Wallis test provides evidence of difference among best performance in the population at the end of 50,000 generations.
```{r ord-stk-kru}
kruskal.test(pop_str_max ~ acron,data = end)
```

Results for post-hoc Wilcoxon rank-sum test with a Bonferroni correction on best performance in the population at the end of 50,000 generations.

```{r ord-stk-wil}
pairwise.wilcox.test(x = end$pop_str_max, g = end$acron, p.adjust.method = "bonferroni",
                     paired = FALSE, conf.int = FALSE, alternative = 'l')
```

